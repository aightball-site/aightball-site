<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIght Ball ‚Äì Coming Soon</title>
  <style>
    :root {
      --bg: #0d0d0d;
      --fg: #f2f2f2;
      --muted: #bbbbbb;
      --card: #111111;
      --border: #333;
      --accent: #33cc99;
      --accent-hover: #2ab386;
      --triW: 160px;
      --triH: 140px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: radial-gradient(1200px 800px at 50% -10%, #1a1a1a, var(--bg));
      color: var(--fg);
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      align-items: start;
    }
    .hero {
      display: grid;
      place-items: center;
      padding: 2.25rem 1.25rem 0.75rem;
    }
    .hero img {
      width: min(70vw, 500px);
      max-height: 45vh;
      object-fit: contain;
      border-radius: 24px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.5);
      user-select: none;
      -webkit-user-drag: none;
    }

    .demo {
      margin: 0.5rem auto 0;
      padding: 1.5rem 1.25rem 2rem;
      border: 1px solid var(--border);
      border-radius: 20px;
      width: min(92vw, 720px);
      background: linear-gradient(180deg, #121212, var(--card));
      box-shadow: 0 24px 50px rgba(0,0,0,.35);
    }

    .oracle-wrap {
      position: relative;
      display: grid;
      place-items: center;
      margin-bottom: 1rem;
      padding: 1rem 0;
      overflow: visible;
    }

    .mist,
    .mist::before,
    .mist::after {
      content: "";
      position: absolute;
      pointer-events: none;
      width: 520px; height: 520px;
      border-radius: 50%;
      filter: blur(26px);
      background:
        radial-gradient(120px 120px at 30% 40%, rgba(51,204,153,.12), transparent 10%),
        radial-gradient(180px 180px at 70% 30%, rgba(100,180,255,.10), transparent 10%),
        radial-gradient(140px 140px at 50% 70%, rgba(255,255,255,.06), transparent 10%);
      animation: drift 18s ease-in-out infinite;
      opacity: .6;
      transform: translate3d(0,0,0);
    }
    .mist { top: -40px; left: 50%; transform: translateX(-50%); }
    .mist::before { top: -30px; left: -80px; animation-duration: 22s; animation-direction: reverse; }
    .mist::after  { top:  10px; left:  80px; animation-duration: 26s; opacity: .5; }
    @keyframes drift {
      0%   { transform: translate(-50%, 0) rotate(0deg); opacity:.55; }
      50%  { transform: translate(-48%, -8px) rotate(6deg); opacity:.8; }
      100% { transform: translate(-50%, 0) rotate(0deg); opacity:.55; }
    }

    .eightball {
      position: relative;
      width: min(68vw, 360px);
      height: min(68vw, 360px);
      border-radius: 50%;
      background: radial-gradient(circle at 35% 30%, #2b2b2b 0%, #111 55%, #000 100%);
      box-shadow: inset 0 -20px 40px rgba(0,0,0,.7), 0 30px 60px rgba(0,0,0,.45);
      display: grid;
      place-items: center;
      overflow: hidden;
      transition: transform .2s cubic-bezier(.2,.8,.2,1);
    }
    .eightball::before {
      content: "";
      position: absolute;
      top: 6%; left: 12%;
      width: 40%; height: 28%;
      background: radial-gradient(ellipse at top left, rgba(255,255,255,.22), rgba(255,255,255,0));
      filter: blur(4px);
      transform: rotate(-12deg);
      pointer-events: none;
    }
    .window{
      position: relative; width:50%; height:50%; border-radius:50%;
      background: radial-gradient(circle at 50% 40%, #0b1b27, #03121c 60%, #01090e 100%);
      box-shadow: inset 0 0 40px rgba(0,0,0,.9);
      display:grid; place-items:center; border:2px solid #0f2a3a; overflow:hidden;
    }
    .window::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle, transparent 70%, rgba(0,0,0,0.7) 100%);
      pointer-events: none;
      z-index: 1;
    }

    .triangle {
      position: absolute;
      left: 50%;
      top: 58%;
      transform: translate(-50%, -50%);
      width: 0; height: 0;
      border-left: calc(var(--triW) / 2) solid transparent;
      border-right: calc(var(--triW) / 2) solid transparent;
      border-top: var(--triH) solid #163a5a;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.6));
    }
    .triangle .msg {
      position: absolute;
      left: 50%;
      top: calc(-1 * var(--triH) * 0.72);
      transform: translateX(-50%);
      width: calc(var(--triW) * 0.8);
      text-align: center;
      font-weight: 800;
      font-size: 1.05rem;
      letter-spacing: 0.5px;
      color: #cde7ff;
      text-shadow: 0 1px 0 rgba(0,0,0,.5);
      line-height: 1.2;
      margin: 0 auto;
    }

    .qa {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem 0 0.25rem;
    }
    .helper { color: var(--muted); margin: 0.25rem 0 0.75rem; text-align: center; }

    .readout { text-align: center; margin: 0.5rem 0 0; line-height: 1.45; }

    /* NEW: Scrollable responses area */
    /* Scrollable responses area */
    .responses-wrap {
      margin-top: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: #121212;
      max-height: 260px;     /* controls visible height */
      overflow: auto;        /* scroll when content grows */
      max-height: 260px;
      overflow: auto;
      padding: 0.5rem;
    }
    .responses-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }
    @media (min-width: 680px){
      .responses-grid { grid-template-columns: 1fr 1fr; }
    }
    .persona-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0.75rem 0.9rem;
      background: linear-gradient(180deg, #131313, #0f0f0f);
    }
    .persona-card h4 {
      margin: 0 0 0.35rem;
      font-size: 0.95rem;
      color: var(--accent);
      letter-spacing: 0.4px;
    }
    .persona-card .odds {
      font-weight: 700;
      margin-bottom: 0.35rem;
    }
    .persona-card p {
      margin: 0;
      color: #e3e3e3;
      line-height: 1.45;
      white-space: pre-wrap;
    }

    .signup {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 1rem;
      margin: 1rem auto 0;
    }
    input[type="email"], input[type="text"] {
      padding: 0.85rem 0.9rem;
      border: none;
      border-radius: 10px;
      min-width: 280px;
      background: #1a1a1a;
      color: var(--fg);
      outline: 1px solid var(--border);
    }
    button {
      padding: 0.9rem 1.2rem;
      border: none;
      border-radius: 12px;
      background: var(--accent);
      color: #02120d;
      font-weight: 700;
      cursor: pointer;
      transition: background .15s ease, transform .08s ease, box-shadow .15s ease;
      box-shadow: 0 8px 18px rgba(51,204,153,.25);
    }
    button:hover { background: var(--accent-hover); }
    button:active { transform: translateY(1px); }

    footer {
      margin: 1.25rem 0 1.5rem;
      text-align: center;
      color: #8a8a8a;
      font-size: 0.95rem;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    @keyframes wobble {
      0%{ transform: rotate(0deg) translateX(0); }
      20%{ transform: rotate(3deg) translateX(6px); }
      40%{ transform: rotate(-3deg) translateX(-6px); }
      60%{ transform: rotate(2deg) translateX(4px); }
      80%{ transform: rotate(-2deg) translateX(-4px); }
      100%{ transform: rotate(0deg) translateX(0); }
    }
    .shake { animation: wobble .6s ease-in-out; }

    .window::after{
      content:"";
      position:absolute;
      inset:-99%;
      opacity: 0.05; 
      background:
        radial-gradient(120px 120px at 30% 40%, rgba(100,180,255,.12), transparent 60%),
        radial-gradient(160px 160px at 70% 70%, rgba(51,204,153,.10), transparent 60%),
        radial-gradient(200px 200px at 50% 30%, rgba(255,255,255,.06), transparent 65%);
      filter: blur(18px) saturate(1.05);
      mix-blend-mode: screen;
      animation: swirl 22s ease-in-out infinite;
      pointer-events:none;
      border-radius: 50%;
      clip-path: circle(50% at 50% 50%);
    }
    .triangle::after{
      content:"";
      position:absolute;
      left:50%; top:calc(-1 * var(--triH));
      transform: translateX(-50%);
      width: var(--triW); height: var(--triH);
      clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
      background:
        radial-gradient(200px 200px at 65% 60%, rgba(180,220,255,.20), transparent 40%),
        radial-gradient(200px 200px at 65% 75%, rgba(51,204,153,.20), transparent 40%);
      filter: blur(10px);
      mix-blend-mode: screen;
      opacity:.7;
      animation: swirl 18s ease-in-out infinite reverse;
      pointer-events:none;
    }
    @keyframes swirl{
      0%{ transform: translateX(-50%) rotate(0deg); opacity:.6; }
      50%{ transform: translateX(-50%) rotate(5deg); opacity:.85; }
      100%{ transform: translateX(-50%) rotate(0deg); opacity:.6; }
    }

    /* NEW: outcome border tints (optional) */
    .demo.tint-good   { border-color: #2ea86b; }
    .demo.tint-mixed  { border-color: #bda32e; }
    .demo.tint-risky  { border-color: #c24d4d; }
  </style>
</head>
<body>
  <!-- HERO -->
  <section class="hero" aria-label="AIght Ball">
    <img src="Images/Logo.jpg" alt="AIght Ball logo" />
  </section>

  <!-- DEMO -->
  <section class="demo" role="region" aria-label="AIght Ball demo">
  <section id="demo" class="demo" role="region" aria-label="AIght Ball demo">
    <div class="oracle-wrap">
      <div class="mist"></div>
      <div id="orb" class="eightball" aria-hidden="true">
        <div class="window">
          <div class="triangle">
            <div id="orb-msg" class="msg">ASK A QUESTION</div>
          </div>
        </div>
      </div>
    </div>

    <form id="question-form" class="qa" autocomplete="off">
      <label class="sr-only" for="user-question">Ask a yes/no question</label>
      <input id="user-question" type="text" name="question" placeholder="Ask a yes/no question‚Ä¶" maxlength="140" />
      <button type="submit" aria-label="Ask the AIght Ball">Ask</button>
      <button type="button" id="shake-btn" aria-label="Shake the ball">Shake It</button>
    </form>
    <p class="helper">Tip: press Enter to ask. Or just shake for a random reading.</p>

    <p id="demo-odds" class="readout">üé≤ Odds: --%</p>
    <p id="demo-text" class="readout">‚ú® Waiting for your question‚Ä¶</p>

    <!-- NEW: Scrollable multi-persona responses -->
    <!-- Scrollable multi-persona responses -->
    <div class="responses-wrap" aria-live="polite">
      <div id="responses" class="responses-grid">
        <!-- persona cards inject here -->
      </div>
    </div>
  </section>

  <!-- Signup -->
  <form class="signup" name="signup" method="POST" data-netlify="true">
    <input type="email" name="email" placeholder="Enter your email for early access" required />
    <button type="submit">Notify Me</button>
  </form>

  <footer>
    ¬© 2025 AIght Ball ¬∑ Follow us on 
    <a href="https://instagram.com/aightball.io" target="_blank" rel="noopener">Instagram</a> &
    <a href="https://youtube.com/@aightballio" target="_blank" rel="noopener">YouTube</a>
  </footer>

<script>
  const orb = document.getElementById('orb');
  const orbMsg = document.getElementById('orb-msg');
  const oddsOut = document.getElementById('demo-odds');
  const textOut = document.getElementById('demo-text');
  const inputEl = document.getElementById('user-question');
  const askBtn = document.querySelector('#question-form button[type="submit"]');
  const shakeBtn = document.getElementById('shake-btn');
  const responsesEl = document.getElementById('responses');
  const demoWrap = document.getElementById('demo'); // NEW

  const personas = [
    { id: 'bold',    label: 'Bold' },
    { id: 'cautious',label: 'Cautious' },
    { id: 'neutral', label: 'Neutral / Practical' },
    { id: 'mystic',  label: 'Mystic' }
  ];

  function shakeOrb() {
    orb.classList.remove('shake');
    void orb.offsetWidth;
    orb.classList.add('shake');
  }

  function setLoading(on) {
    askBtn.disabled = on;
    shakeBtn.disabled = on;
    if (on) {
      orbMsg.textContent = "‚Ä¶";
      oddsOut.textContent = "üé≤ Odds: ‚Äî";
      textOut.textContent = "‚ú® Consulting the orb‚Ä¶";
      // clear persona cards placeholder
      renderPersonaSkeletons();
    }
  }

  function fallback() {
    return {
      short: "62%",
      long: "Currents are moving in your favor, but attention to small details will preserve the edge.",
      odds: 62
    };
  }

  // NEW: tiny ‚Äútone wrapper‚Äù for safe fallback if API ignores persona
  // legacy persona wrapper (kept; unused by new flow but safe to keep)
  function wrapByPersona(baseLong, personaId, question){
    const q = (question || '').toLowerCase();
    const tag =
      personaId === 'bold'    ? "Play it strong: " :
      personaId === 'cautious'? "Proceed, but hedge: " :
      personaId === 'neutral' ? "Practical take: " :
      /* mystic */              "The currents whisper: ";

    // a couple micro-specifics to vary endings without needing backend changes
                                "The currents whisper: ";
    let finisher = " Keep your energy and boundaries clear.";
    if (q.includes('dinner') || q.includes('food') || q.includes('eat')){
      finisher = " Try one concrete step tonight (pick a dish, set a time, go).";
    } else if (q.includes('relationship') || q.includes('date') || q.includes('partner')){
      finisher = " Name a need, ask a question, and give space for a real answer.";
    } else if (q.includes('job') || q.includes('career') || q.includes('work')){
      finisher = " Make one measurable move in the next 48 hours.";
    }
    return tag + baseLong.replace(/\s+$/,'') + finisher;
  }

  function createCard({label, odds, long}) {
    const div = document.createElement('div');
    div.className = 'persona-card';
    div.innerHTML = `
      <h4>${label}</h4>
      <div class="odds">Odds: ${Number.isFinite(odds) ? odds + '%' : '--'}</div>
      <p>${long}</p>
    `;
    return div;
  }

  function renderPersonaSkeletons(){
    responsesEl.innerHTML = '';
    personas.forEach(p=>{
      const skeleton = document.createElement('div');
      skeleton.className = 'persona-card';
      skeleton.innerHTML = `
        <h4>${p.label}</h4>
        <div class="odds">Odds: ‚Ä¶</div>
        <p>Thinking‚Ä¶</p>
      `;
      responsesEl.appendChild(skeleton);
    });
  }

  async function fetchReading(question, personaId){
    // Try persona-aware first. If backend ignores 'persona', we still get a normal reading.
    const controller = new AbortController();
    const timer = setTimeout(() => controller.abort(), 20000);
    try{
      const resp = await fetch("/api/reading", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(personaId ? { question, persona: personaId } : { question }),
        signal: controller.signal
      });
      const data = await resp.json().catch(()=>null);
      return data || null;
    } catch(e){
      return null;
    } finally {
      clearTimeout(timer);
    }
  }

  /* -------- NEW HELPERS: split % to personas + persona voice + border tint -------- */

  function clamp(n, a=0, b=1){ return Math.min(b, Math.max(a, n)); }

  // Turn a single 0‚Äì100 positive odds into 4 persona buckets summing to 100
  function splitPersonaShares(posOdds){
    const p = clamp(posOdds/100);          // 0..1
    const amb = 1 - Math.abs(p - 0.5)*2;   // 1 at 50/50, 0 at extremes
    let wBold    = 0.55*p + 0.10*amb;
    let wCaut    = 0.55*(1-p) + 0.10*amb;
    let wNeutral = 0.80*amb;
    let wMystic  = Math.max(0, 1 - (wBold+wCaut+wNeutral));

    const S = wBold + wCaut + wNeutral + wMystic || 1;
    let arr = [wBold/S, wCaut/S, wNeutral/S, wMystic/S].map(x => Math.round(x*100));
    let diff = 100 - arr.reduce((a,b)=>a+b,0);
    while (diff !== 0){
      const idx = diff > 0 ? arr.indexOf(Math.max(...arr)) : arr.indexOf(Math.min(...arr));
      arr[idx] += diff > 0 ? 1 : -1;
      diff = 100 - arr.reduce((a,b)=>a+b,0);
    }
    return { bold: arr[0], cautious: arr[1], neutral: arr[2], mystic: arr[3] };
  }

  function personaWrite(personaId, posOdds, question){
    const q = (question||'').toLowerCase();
    const tip =
      q.includes('dinner')||q.includes('food')||q.includes('eat') ? " Pick a dish and time‚Äîcommit." :
      (q.includes('relationship')||q.includes('date')||q.includes('partner')) ? " Say one need aloud and invite an honest reply." :
      (q.includes('job')||q.includes('career')||q.includes('work')) ? " Make one measurable move inside 48 hours." :
      " Keep your energy and boundaries clear.";
    const p = posOdds;
    const positive = p >= 60;
    const negative = p <= 40;

    const voices = {
      bold:     { pos:"Green lights. Act now, don‚Äôt over-optimize‚Äîship it.",
                  neg:"Odds are rough. If you go, go loud‚Äîown the risk and the outcome.",
                  mid:"Momentum is there if you create it‚Äîchoose a line and punch through." },
      cautious: { pos:"Good signs, but protect the downside‚Äîset limits and a stop-loss.",
                  neg:"This reads red. Pause, gather facts, and re-attempt with safeguards.",
                  mid:"Mixed read. Test small, observe, then scale or stand down." },
      neutral:  { pos:"Favorable, with practical upside‚Äîwrite the next two steps.",
                  neg:"Not favorable‚Äîwhat must be true to proceed? If you can‚Äôt meet it, pass.",
                  mid:"Fifty-fifty‚Äîdefine success criteria and a clear no-go line." },
      mystic:   { pos:"The current lifts you‚Äîfollow the quiet ‚Äòyes‚Äô and keep your grip light.",
                  neg:"Turbid waters‚Äîsit still until the silt settles; the path will show.",
                  mid:"Two tides meet here‚Äîlisten for the smaller signal underneath the noise." }
    };

    const bundle = voices[personaId];
    const line = positive ? bundle.pos : negative ? bundle.neg : bundle.mid;
    const tag =
      personaId==='bold'    ? "Bold ‚Äî " :
      personaId==='cautious'? "Cautious ‚Äî " :
      personaId==='neutral' ? "Practical ‚Äî " : "Mystic ‚Äî ";
    return tag + line + tip;
  }

  function tintBorder(posOdds){
    demoWrap.classList.remove('tint-good','tint-mixed','tint-risky');
    if (posOdds >= 60) demoWrap.classList.add('tint-good');
    else if (posOdds <= 40) demoWrap.classList.add('tint-risky');
    else demoWrap.classList.add('tint-mixed');
  }

  /* ---------------------------- MAIN ACTION ---------------------------- */

  async function askAightBall(question) {
    setLoading(true);
    try {
      // Base call (keeps existing top readouts working exactly as before)
      const baseData = await fetchReading(question, null);
      const f = fallback();

      const odds = Number.isFinite(Number(baseData?.odds))
        ? Math.max(0, Math.min(100, Math.round(baseData.odds)))
        : 50;

      const long = (typeof baseData?.long === "string" && baseData.long.trim())
        ? baseData.long.trim()
        : f.long;

      const short = /^\d{1,3}%$/.test(String(baseData?.short))
        ? String(baseData.short)
        : `${odds}%`;

      oddsOut.textContent = `üé≤ Odds: ${odds}%`;
      textOut.textContent = `‚ú® ${long}` + (baseData?.debug ? ` (debug: ${JSON.stringify(baseData.debug)})` : "");
      orbMsg.textContent = short;
      shakeOrb();

      // Persona calls in parallel; if any fail, synthesize from base
      const personaPromises = personas.map(async (p) => {
        const d = await fetchReading(question, p.id);
        const pOdds = Number.isFinite(Number(d?.odds)) ? Math.max(0, Math.min(100, Math.round(d.odds))) : odds;
        const pLong = (typeof d?.long === "string" && d.long.trim())
            ? d.long.trim()
            : wrapByPersona(long, p.id, question);

        return { label: p.label, odds: pOdds, long: pLong };
      });

      const results = await Promise.allSettled(personaPromises);
      // NEW: deterministic split into persona shares (sum = 100), persona voice text, border tint
      const shares = splitPersonaShares(odds);
      tintBorder(odds);

      responsesEl.innerHTML = '';
      results.forEach((res, idx) => {
        const label = personas[idx].label;
        if (res.status === 'fulfilled' && res.value){
          responsesEl.appendChild(createCard(res.value));
        } else {
          // ultra-safe fallback
          responsesEl.appendChild(createCard({
            label,
            odds,
            long: wrapByPersona(long, personas[idx].id, question)
          }));
        }
      [
        { id:'bold',    label:'Bold',               pct: shares.bold    },
        { id:'cautious',label:'Cautious',           pct: shares.cautious},
        { id:'neutral', label:'Neutral / Practical',pct: shares.neutral },
        { id:'mystic',  label:'Mystic',             pct: shares.mystic  }
      ].forEach(row=>{
        responsesEl.appendChild(createCard({
          label: row.label,
          odds: row.pct,
          long: personaWrite(row.id, odds, question)
        }));
      });

    } catch (e) {
      const f = fallback();
      oddsOut.textContent = `üé≤ Odds: ${f.odds}%`;
      textOut.textContent = `‚ú® ${f.long}`;
      orbMsg.textContent = f.short;
      shakeOrb();

      // basic fallback persona cards
      responsesEl.innerHTML = '';
      personas.forEach(p=>{
        responsesEl.appendChild(createCard({
          label: p.label,
          odds: f.odds,
          long: wrapByPersona(f.long, p.id, question)
        }));
      });
      console.warn("AIght Ball fallback (timeout/network):", e);
    } finally {
      setLoading(false);
    }
  }

  document.getElementById('shake-btn').addEventListener('click', () => {
    const q = inputEl.value.trim() || "Surprise me";
    askAightBall(q);
  });

  document.getElementById('question-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const q = inputEl.value.trim() || "Surprise me";
    askAightBall(q);
  });
</script>
</body>
</html>















































